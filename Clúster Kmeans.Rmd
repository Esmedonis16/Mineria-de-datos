---
title: "Clúster kmeans"
author: "Linda Morales"
date: "2025-11-10"
output: pdf_document
---

### Procedemos a la instalación de librerías:

```{r}
install.packages("rmarkdown")
install.packages("arules", type ="binary")
library(arules)
install.packages("readxl")
library(readxl)
search()
ls("package:readxl")
install.packages(c("dplyr","purrr","tibble"))

```

### Leemos todos los documentos, desde el año 2018 hasta el 2024

```{r}
dt2018 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/2-sindicados-mp-2018.xlsx")
dt2019 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/2-sindicados-mp-2019.xlsx")
dt2020 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/2-sindicados-mp-2020.xlsx")
dt2021 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/2-sindicados-mp-2021.xlsx")
dt2022 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/2-sindicados-mp-2022.xlsx")
dt2023 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-datos/mp-sindicados-2023.xlsx")
dt2024 <- readxl::read_excel("C:/Users/DELL/Documents/Mineria-de-dat/base-de-datos-mp-sindicados-2024.xlsx")
```

### Revisamos los nombres de las columnas

```{r}
colnames(dt2018)
colnames(dt2019)
colnames(dt2020)
colnames(dt2021)
colnames(dt2022)
colnames(dt2023)
colnames(dt2024)
```

### Renombramos y seleccionamos solo las columnas comunes: Alineamiento de columnas, ya que no son iguales en todos los años las estandarizamos:

```{r}
estandarizar <- function(df, sexo, edad, grupo_edad, depto, zona, delito) {
  df %>%
    rename(
      sexo = {{sexo}},
      edad = {{edad}},
      grupo_edad = {{grupo_edad}},
      depto = {{depto}},
      zona = {{zona}},
      delito = {{delito}}
    ) %>%
    select(sexo, edad, grupo_edad, depto, zona, delito)
}

dt2024 <- estandarizar(dt2024, sexo_sindicados, edad_sind, g_edad_60ymas, depto_ocu_hecho, zona_ocu_hecho, principales_delitos)
dt2023 <- estandarizar(dt2023, sexo_per, edad_sind, g_edad_60ymas, depto_ocu_hecho, zona_ocu_hecho, principales_delitos)
dt2022 <- estandarizar(dt2022, sexo_sindicados, edad_sind, g_edad_60ymas, depto_ocu_hecho, zona_ocu_hecho, delito_com)
dt2021 <- estandarizar(dt2021, sexo_sindicados, edad_sind, g_edad_60ymas, depto_ocu_hecho, zona_ocu_hecho, delito_com)
dt2020 <- estandarizar(dt2020, sexo_sindicados, edad_sind, g_edad_60ymás, depto_ocu_hecho, zona_ocu_hecho, delito_cod)
dt2019 <- estandarizar(dt2019, sexo_sindicados, edad_sind, g_edad_60ymás, depto_ocu, zona_ocu, delito_com)
dt2018 <- estandarizar(dt2018, sexo_sindicados, edad_per, g_edad_60ymas, depto_ocu, zona_ocu, delito_com)
```

### Unificamos todos los dataset:

```{r}
datos <- bind_rows(dt2018, dt2019, dt2020, dt2021, dt2022, dt2023, dt2024)
```

## Librerías necesarias

```{r}
# Instalamos si es necesario
install.packages("ggplot2")
install.packages("devtools")
devtools::install_github("hrbrmstr/ggalt")

# Cargamos
library(ggplot2)
library(ggalt)
library(dplyr)

```

## Preparamos los datos

```{r}
# 1. Seleccionamos variables relevantes para agrupar
data_cluster <- datos %>%
  select(edad, sexo, grupo_edad, delito, zona)  # Variables numéricas o categóricas codificadas

# 2. Convertimos valores faltantes (si hay) a -1 para evitar errores
data_cluster[is.na(data_cluster)] <- -1

# 3. Filtramos solo casos del departamento 1, ocurridos en zona 1 y con grupo_edad menor a 6
data_cluster <- datos %>%
  filter(depto == 1, zona == 1, grupo_edad < 6) %>%
  select(edad, sexo, grupo_edad, delito, zona)

# 4. Nuevamente limpiamos los NA por si acaso
data_cluster[is.na(data_cluster)] <- -1

```

## Ejecutamos K-Means

```{r}
# Aplicamos K-Means con 3 clústers
set.seed(123)  # Para reproducibilidad
modelo_kmeans <- kmeans(data_cluster, centers = 3)

# Agregamos el clúster a los datos
data_cluster$cluster <- as.factor(modelo_kmeans$cluster)



```

## Visualización Clásica: Edad vs Delito

```{r}

ggplot(data_cluster, aes(x = edad, y = delito, color = cluster, shape = cluster)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_point(data = as.data.frame(modelo_kmeans$centers),
             aes(x = edad, y = delito), color = "black", fill = "yellow", size = 5, shape = 21) +
  geom_encircle(aes(group = cluster, fill = cluster),
                alpha = 0.2, s_shape = 1, expand = 0.05) +
  scale_color_manual(values = c("red", "green", "blue")) +
  scale_shape_manual(values = c(16, 17, 15)) +
  labs(title = "Agrupamiento de Delitos por Edad en Zona 1",
       x = "Edad", y = "Delito") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.title = element_blank()
  )


```

# Interpretación del Clustering

El gráfico muestra el resultado de aplicar el algoritmo **K-Means con 3 clústeres** sobre los delitos cometidos en el **departamento de Guatemala (1), zona 1**, considerando como variables la **edad** y el **tipo de delito**.

**Clúster 1 (rojo):** Agrupa principalmente a personas jóvenes, entre 0 y aproximadamente 20 años, que están involucradas en delitos de menor severidad (valores de delito bajos). Representa una franja vulnerable de jóvenes que podrían estar relacionados con delitos menores o faltas.

**Clúster 2 (verde):** Representa el grupo más denso. Incluye una gran cantidad de edades entre 20 y 35 años, asociados a una amplia gama de delitos de tipo medio. Este grupo podría representar la población adulta más activa en términos de criminalidad.

**Clúster 3 (azul):** Agrupa exclusivamente casos que presentan un único tipo de delito (valor muy alto y constante en el eje Y), lo cual podría indicar errores de codificación (por ejemplo, valores como `999` usados para indicar desconocido o no declarado). Este grupo podría requerir depuración o tratamiento especial.
